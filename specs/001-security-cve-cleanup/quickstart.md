# Quickstart: Security CVE Exception Cleanup

**Feature**: 001-security-cve-cleanup
**Date**: 2026-01-31

## Prerequisites

- Repository cloned with write access
- pnpm 10.28.2+ installed
- GitHub repository admin access (for Dependabot settings)

---

## Quick Implementation Steps

### 1. Update npm Dependencies

```bash
# Update fast-xml-parser to 5.3.4+ (fixes CVE-2026-25128)
pnpm update

# Verify update
pnpm ls fast-xml-parser
# Expected: 5.3.4 or higher
```

### 2. Verify Dockerfile Versions

```bash
# Check reviewdog version (should already be 0.21.0)
grep "REVIEWDOG_VERSION" router/Dockerfile
# Expected: ARG REVIEWDOG_VERSION=0.21.0
```

### 3. Clean Up .trivyignore

Remove these CVEs (now fixed):

- `CVE-2026-25128` (fast-xml-parser)
- `CVE-2025-61726` (reviewdog stdlib)
- `CVE-2025-61728` (reviewdog stdlib)
- `CVE-2025-22869` (reviewdog crypto/ssh)
- `CVE-2024-24790` (reviewdog net/netip)

Update remaining entries with structured format:

```
# CVE-ID: CVE-YYYY-NNNNN
# Created: 2026-01-31
# Expires: 2026-07-30
# Package: [name]
# Version: [version]
# Fixed-In: [version or N/A]
# Risk: LOW
# Justification: [explanation]
# Upstream: [URL or N/A]
CVE-YYYY-NNNNN
```

### 4. Create CODEOWNERS File

```bash
cat > CODEOWNERS << 'EOF'
# Security-sensitive files require designated owner review
.trivyignore @oddessentials
SECURITY.md @oddessentials
.github/dependabot.yml @oddessentials
router/Dockerfile @oddessentials
EOF
```

### 5. Enable GitHub Security Features

Via GitHub UI:

1. Navigate to **Settings > Code security**
2. Enable **Dependabot alerts**
3. Enable **Dependabot security updates**

### 6. Add Reviewdog Smoke Test

Create fixture:

```bash
mkdir -p tests/fixtures
cat > tests/fixtures/reviewdog-smoke.diff << 'EOF'
diff --git a/test.txt b/test.txt
index 1234567..abcdefg 100644
--- a/test.txt
+++ b/test.txt
@@ -1,3 +1,3 @@
 line 1
-line 2
+line 2 modified
 line 3
EOF
```

#### Smoke Test Diff Requirements

The `reviewdog-smoke.diff` fixture must satisfy these minimum criteria:

1. **Valid unified diff format**: Must include `diff --git`, `---`, `+++`, and `@@` markers
2. **At least one hunk**: Must contain at least one change block with context lines
3. **Parseable by reviewdog**: Running `reviewdog -f=diff -reporter=local < fixture.diff` must exit 0
4. **Non-empty change**: Must include at least one added (+) or removed (-) line

**Invalid fixtures** (will cause smoke test failure):

- Empty file
- File with only comments
- Malformed diff headers
- Missing hunk markers

Add to CI (`.github/workflows/ci.yml`):

```yaml
- name: Reviewdog smoke test
  run: |
    docker run --rm odd-ai-reviewers-router:ci \
      reviewdog -f=diff -reporter=local < tests/fixtures/reviewdog-smoke.diff
    echo "Reviewdog smoke test passed"
```

### 7. Run Trivy Scan

```bash
# Build and scan
docker build -t odd-ai-reviewers-router:ci -f router/Dockerfile .
docker run --rm aquasec/trivy:latest image \
  --severity HIGH,CRITICAL \
  --ignore-unfixed \
  --ignorefile .trivyignore \
  odd-ai-reviewers-router:ci
```

---

## Verification Checklist

- [ ] `pnpm ls fast-xml-parser` shows 5.3.4+
- [ ] Dockerfile has `REVIEWDOG_VERSION=0.21.0`
- [ ] .trivyignore has 10 or fewer CVE entries
- [ ] All entries have Created/Expires dates
- [ ] CODEOWNERS file exists with security paths
- [ ] Trivy scan passes with no new HIGH/CRITICAL CVEs
- [ ] Reviewdog smoke test passes in CI

---

## Troubleshooting

### fast-xml-parser won't update

Check if @azure/core-xml constraint allows 5.3.4:

```bash
pnpm why fast-xml-parser
# If locked to old version, may need pnpm update --force
```

### Trivy reports new CVEs after cleanup

New CVEs may have been published. Check if:

1. CVE is in a direct dependency (update it)
2. CVE is in upstream binary (add to .trivyignore with proper documentation)

### CODEOWNERS not enforcing reviews

Ensure branch protection is enabled:

1. **Settings > Branches > main**
2. Enable **Require a pull request before merging**
3. Enable **Require review from Code Owners**
