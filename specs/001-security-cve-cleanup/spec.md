# Feature Specification: Security CVE Exception List Cleanup and Monitoring

**Feature Branch**: `001-security-cve-cleanup`
**Created**: 2026-01-31
**Status**: Complete
**Input**: User description: "review SECURITY.md, verify and test a deterministic enterprise-grade solution. Review our existing exception list to determine if any of this can be safely cleaned up. Take your time and confirm any assumptions."

## Clarifications

### Session 2026-01-31

- Q: What is the authoritative source for "upstream fix available" monitoring? → A: GitHub Security Advisories via Dependabot (native alerts + auto-PRs)
- Q: What is the maximum age for a CVE exception before mandatory escalation? → A: 180 days; requires documented re-approval or escalation
- Q: What functional validation is required for P1 dependency updates beyond Trivy? → A: Reviewdog smoke test on a sample diff file as CI gate
- Q: Who is the accountable owner for CVE exceptions and security reviews? → A: CODEOWNERS entry for .trivyignore and security docs with designated team/individual

## User Scenarios & Testing _(mandatory)_

### User Story 1 - Update Fixable Dependencies (Priority: P1)

A maintainer reviews the current CVE exception list and updates dependencies where upstream fixes are now available, removing those CVEs from the ignore list to reduce accepted risk.

**Why this priority**: Immediately reduces the security risk surface by updating dependencies with known fixes. Addresses 5 CVEs that have fixes available today: CVE-2026-25128 (fast-xml-parser), CVE-2025-61726, CVE-2025-61728 (reviewdog stdlib), CVE-2025-22869, CVE-2024-24790 (reviewdog libraries).

**Independent Test**: Can be fully tested by running `pnpm update` for npm dependencies and updating the Dockerfile for reviewdog, then running Trivy scan to verify CVEs are resolved.

**Acceptance Scenarios**:

1. **Given** fast-xml-parser 5.3.3 is installed with CVE-2026-25128, **When** the maintainer runs dependency update, **Then** fast-xml-parser updates to 5.3.4+ and CVE-2026-25128 is removed from .trivyignore
2. **Given** reviewdog v0.20.3 is installed with Go 1.21.7 CVEs, **When** the maintainer updates Dockerfile to v0.21.0, **Then** CVE-2025-61726, CVE-2025-61728, CVE-2025-22869, and CVE-2024-24790 are removed from .trivyignore
3. **Given** CI pipeline runs Trivy scan, **When** the scan completes, **Then** no new HIGH/CRITICAL CVEs are reported (existing unfixed upstream CVEs remain suppressed)
4. **Given** reviewdog binary is updated, **When** CI runs the smoke test, **Then** reviewdog successfully parses a known diff fixture without errors

---

### User Story 2 - Configure Real-Time CVE Monitoring (Priority: P2)

A maintainer sets up automated monitoring that alerts when upstream fixes become available for CVEs currently in the exception list, enabling proactive security maintenance.

**Why this priority**: Ensures the team is notified promptly when fixes become available, rather than relying on periodic manual reviews. Transforms reactive security posture to proactive.

**Independent Test**: Can be tested by configuring a monitoring system and simulating a CVE fix notification, verifying the alert reaches the appropriate channel.

**Acceptance Scenarios**:

> **Note**: Scenarios 1-3 are operational criteria verified post-deployment, not PR-testable. PR verification: confirm Dependabot alerts are enabled in GitHub Security settings.

1. **Given** a CVE is listed in .trivyignore with upstream dependency reference, **When** the upstream project releases a fix, **Then** Dependabot generates a security alert within 24 hours _(operational)_
2. **Given** Dependabot is configured, **When** a new security advisory is published for a tracked dependency, **Then** Dependabot automatically opens a pull request with the fix _(operational)_
3. **Given** Dependabot has been active for 7 days, **When** maintainer checks the Security tab, **Then** they can see which ignored CVEs have pending Dependabot PRs available _(operational)_
4. **Given** the PR is ready to merge, **When** reviewer checks GitHub Settings > Security, **Then** Dependabot alerts and security updates are enabled _(PR-testable)_

---

### User Story 3 - Document CVE Exception Governance (Priority: P3)

A maintainer establishes clear documentation for the CVE exception process, including review cadence, approval criteria, and escalation procedures for enterprise compliance.

**Why this priority**: Provides audit trail and governance documentation required for enterprise security compliance. Ensures consistent handling of security exceptions across team members.

**Independent Test**: Can be tested by following the documented process to add a hypothetical new CVE exception, verifying all steps are clear and complete.

**Acceptance Scenarios**:

1. **Given** a new CVE is discovered in a dependency, **When** a maintainer follows the exception process, **Then** they can document the risk assessment, justification, and approval in a standardized format
2. **Given** the exception documentation exists, **When** a security auditor reviews the project, **Then** they can trace each ignored CVE to its risk assessment and CODEOWNERS approval
3. **Given** quarterly review is due, **When** CODEOWNERS-designated reviewer checks the documentation, **Then** they have a clear checklist of items to verify for each exception
4. **Given** a PR modifies .trivyignore, **When** the PR is opened, **Then** GitHub automatically requests review from the designated CODEOWNERS

---

### Edge Cases

- What happens when an upstream project abandons maintenance and no fix will be released?
  - Document in exception with "WONTFIX-UPSTREAM" status and evaluate alternative tools
- How does the system handle CVEs in transitive dependencies multiple levels deep?
  - Track the full dependency chain in comments; use pnpm overrides if needed
- What happens when a monitoring alert fires but the fix introduces breaking changes?
  - Create a tracking issue, assess impact, and update exception with "PENDING-BREAKING-CHANGE" status
- How does the system handle when Trivy database has different CVE data than upstream?
  - Document discrepancies in exception comments with dates verified

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: System MUST update fast-xml-parser to version 5.3.4+ to resolve CVE-2026-25128
- **FR-002**: System MUST update reviewdog to version 0.21.0 to resolve CVE-2025-22869 and CVE-2024-24790 (Note: CVE-2025-61726 and CVE-2025-61728 remain due to Go 1.25.0 compilation)
- **FR-003**: System MUST remove resolved CVEs from .trivyignore file after successful dependency updates
- **FR-004**: System MUST maintain documentation for each CVE exception including: CVE ID, affected package, risk assessment, justification, review date, and upstream tracking link
- **FR-005**: System MUST configure GitHub Dependabot alerts as the authoritative source for tracking when upstream fixes become available for ignored CVEs
- **FR-006**: System MUST enable Dependabot security PRs to automatically create actionable pull requests when fixes are detected
- **FR-007**: System MUST verify all dependency updates pass CI security scan (Trivy) and functional smoke tests before merging
- **FR-007a**: System MUST run reviewdog against a sample diff file as a smoke test gate for reviewdog binary updates
- **FR-008**: System MUST update the "Last reviewed" date in .trivyignore header after each review
- **FR-009**: System MUST retain OpenCode-related CVE exceptions (CVE-2025-61729, CVE-2025-47907, CVE-2025-58183, CVE-2025-22868, CVE-2024-34156, CVE-2024-45337, CVE-2023-45288) until upstream releases fix
- **FR-010**: System MUST retain build-time-only CVE exceptions (CVE-2025-64756, CVE-2026-23745, CVE-2026-23950, CVE-2026-24842) with documented risk assessment
- **FR-011**: System MUST enforce a 180-day maximum age for CVE exceptions; exceptions older than 180 days require documented re-approval or escalation to CODEOWNERS
- **FR-012**: System MUST track exception creation date in .trivyignore comments to enable age-based enforcement
- **FR-013**: System MUST add CODEOWNERS entry for `.trivyignore` and `SECURITY.md` to enforce designated reviewer approval
- **FR-014**: System MUST require CODEOWNERS approval for any changes to CVE exception list or security documentation

### Key Entities

- **CVE Exception**: A documented security vulnerability that is acknowledged but not immediately fixable, containing: CVE ID, severity, affected package, version, fix version (if known), risk assessment, justification, upstream issue link, creation date, review date, and expiration date (creation + 180 days)
- **Monitoring Alert**: A notification triggered when an upstream fix becomes available, containing: CVE ID, new version with fix, detection timestamp, and recommended action
- **Exception Review**: A periodic audit of all CVE exceptions, containing: review date, reviewer, disposition for each CVE (keep/remove/escalate), and updated risk assessments

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: CVE exception count reduces from 15 to 13 after initial cleanup (removing 2 fixable CVEs: 1 npm CVE-2026-25128, 2 reviewdog CVE-2025-22869/CVE-2024-24790)
- **SC-002**: CI security scan passes with no new HIGH/CRITICAL vulnerabilities after dependency updates
- **SC-003**: Monitoring system detects and alerts on upstream CVE fixes within 24 hours of release
- **SC-004**: All remaining CVE exceptions have documented risk assessments with review dates within 90 days
- **SC-005**: Time from upstream fix availability to project update reduces from unknown/reactive to under 7 days

## Assumptions

- The @azure/core-xml package's semver range (^5.0.7) allows automatic update to fast-xml-parser 5.3.4
- Reviewdog v0.21.0 binary is compatible with existing workflow and diff parsing
- OpenCode v1.1.47 (latest) is compiled with Go 1.25.x or newer and may fix some Go runtime CVEs (requires verification)
- GitHub Actions or Dependabot alerts can serve as foundation for real-time monitoring
- The project uses GitHub for issue tracking and can integrate automated issue creation
