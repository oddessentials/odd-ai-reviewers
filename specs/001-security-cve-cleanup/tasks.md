# Tasks: Security CVE Exception List Cleanup and Monitoring

**Input**: Design documents from `/specs/001-security-cve-cleanup/`
**Prerequisites**: plan.md, spec.md, research.md, data-model.md, contracts/

**Tests**: No automated tests requested. Validation via Trivy scan and manual verification.

**Organization**: Tasks are grouped by user story to enable independent implementation and testing of each story.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (e.g., US1, US2, US3)
- Include exact file paths in descriptions

## Path Conventions

This feature modifies configuration files at repository root:

- `.trivyignore` - CVE exception list
- `CODEOWNERS` - Governance file
- `.github/dependabot.yml` - Dependency monitoring config
- `.github/workflows/ci.yml` - CI workflow
- `tests/fixtures/` - Test fixtures

---

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Verify current state and prepare for changes

- [ ] T001 Verify reviewdog version in router/Dockerfile is 0.21.0 (already done per research)
- [ ] T002 Run `pnpm update` to update fast-xml-parser to 5.3.4+ in pnpm-lock.yaml
- [ ] T003 Verify fast-xml-parser version with `pnpm ls fast-xml-parser` (expect 5.3.4+)

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Create shared infrastructure needed by all user stories

**âš ï¸ CRITICAL**: User story work can begin after this phase

- [ ] T004 Create tests/fixtures/ directory for smoke test fixtures
- [ ] T005 [P] Create reviewdog smoke test fixture in tests/fixtures/reviewdog-smoke.diff

**Checkpoint**: Foundation ready - user story implementation can now proceed

---

## Phase 3: User Story 1 - Update Fixable Dependencies (Priority: P1) ðŸŽ¯ MVP

**Goal**: Remove 5 CVEs from .trivyignore that have upstream fixes, reducing exception count from 15 to 10

**Independent Test**: Run `docker build` and Trivy scan; verify no new HIGH/CRITICAL CVEs and removed CVEs no longer appear

### Implementation for User Story 1

- [ ] T006 [US1] Remove CVE-2026-25128 (fast-xml-parser) entry from .trivyignore
- [ ] T007 [P] [US1] Remove CVE-2025-61726 (reviewdog stdlib) entry from .trivyignore
- [ ] T008 [P] [US1] Remove CVE-2025-61728 (reviewdog stdlib) entry from .trivyignore
- [ ] T009 [P] [US1] Remove CVE-2025-22869 (reviewdog crypto/ssh) entry from .trivyignore
- [ ] T010 [P] [US1] Remove CVE-2024-24790 (reviewdog net/netip) entry from .trivyignore
- [ ] T011 [US1] Update reviewdog section header comment in .trivyignore (remove v0.20.3 reference since CVEs are gone)
- [ ] T012 [US1] Update "Last reviewed" date in .trivyignore header to 2026-01-31
- [ ] T013 [US1] Add reviewdog smoke test job to .github/workflows/ci.yml in container-security section
- [ ] T014 [US1] Verify Trivy scan passes with updated .trivyignore by running local docker build and scan

**Checkpoint**: At this point, User Story 1 should be fully functional - CVE count reduced to 10, CI passes

---

## Phase 4: User Story 2 - Configure Real-Time CVE Monitoring (Priority: P2)

**Goal**: Enable Dependabot security alerts as authoritative source for fix availability notifications

**Independent Test**: Verify GitHub Security tab shows Dependabot alerts enabled; check existing alerts appear in Security > Dependabot alerts

### Implementation for User Story 2

- [ ] T015 [US2] Document Dependabot security alert enablement steps in specs/001-security-cve-cleanup/SETUP-INSTRUCTIONS.md
- [ ] T016 [US2] Add "Go Binary Monitoring" section to SECURITY.md documenting manual review process for OpenCode/reviewdog CVEs
- [ ] T017 [US2] Update .trivyignore header to include "Next review due" date (2026-04-30, 90 days from now)

**Note**: Dependabot security alerts are enabled via GitHub UI (Settings > Security > Dependabot alerts), not via config files. T015 documents this manual step.

**Checkpoint**: At this point, User Story 2 is complete - monitoring configured, gaps documented

---

## Phase 5: User Story 3 - Document CVE Exception Governance (Priority: P3)

**Goal**: Establish CODEOWNERS governance and add structured metadata to all remaining CVE exceptions

**Independent Test**: Create a test PR modifying .trivyignore; verify GitHub requests review from @oddessentials

### Implementation for User Story 3

- [ ] T018 [US3] Create CODEOWNERS file with security-sensitive path entries
- [ ] T019 [US3] Add .trivyignore entry to CODEOWNERS (owner: @oddessentials)
- [ ] T020 [P] [US3] Add SECURITY.md entry to CODEOWNERS (owner: @oddessentials)
- [ ] T021 [P] [US3] Add .github/dependabot.yml entry to CODEOWNERS (owner: @oddessentials)
- [ ] T022 [P] [US3] Add router/Dockerfile entry to CODEOWNERS (owner: @oddessentials)
- [ ] T023 [US3] Add structured metadata (Created/Expires/Package/Risk) to CVE-2025-61729 entry in .trivyignore
- [ ] T024 [P] [US3] Add structured metadata to CVE-2025-47907 entry in .trivyignore
- [ ] T025 [P] [US3] Add structured metadata to CVE-2025-58183 entry in .trivyignore
- [ ] T026 [P] [US3] Add structured metadata to CVE-2025-64756 entry in .trivyignore
- [ ] T027 [P] [US3] Add structured metadata to CVE-2025-22868 entry in .trivyignore
- [ ] T028 [P] [US3] Add structured metadata to CVE-2024-34156 entry in .trivyignore
- [ ] T029 [P] [US3] Add structured metadata to CVE-2026-23745 entry in .trivyignore
- [ ] T030 [P] [US3] Add structured metadata to CVE-2026-23950 entry in .trivyignore
- [ ] T031 [P] [US3] Add structured metadata to CVE-2026-24842 entry in .trivyignore
- [ ] T032 [P] [US3] Add structured metadata to CVE-2024-45337 entry in .trivyignore
- [ ] T033 [P] [US3] Add structured metadata to CVE-2023-45288 entry in .trivyignore

**Checkpoint**: At this point, User Story 3 is complete - CODEOWNERS enforces governance, all exceptions documented

---

## Phase 6: Polish & Cross-Cutting Concerns

**Purpose**: Final validation and documentation updates

- [ ] T034 Run quickstart.md validation checklist manually
- [ ] T034a [P] Document 180-day enforcement process in SECURITY.md (manual quarterly review until automation added)
- [ ] T035 [P] Update SECURITY.md with link to .trivyignore format documentation
- [ ] T036 Build Docker image and run full Trivy scan to verify no regressions
- [ ] T037 Verify CVE exception count is 10 or fewer (SC-001)
- [ ] T038 Update spec.md status from "Draft" to "Complete"

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Setup completion
- **User Story 1 (Phase 3)**: Depends on Foundational - this is the MVP
- **User Story 2 (Phase 4)**: Depends on Foundational - can run parallel to US1
- **User Story 3 (Phase 5)**: Depends on US1 completion (needs cleaned .trivyignore)
- **Polish (Phase 6)**: Depends on all user stories being complete

### User Story Dependencies

- **User Story 1 (P1)**: No dependencies on other stories - **MVP**
- **User Story 2 (P2)**: Can start after Foundational - independent of US1
- **User Story 3 (P3)**: Should follow US1 (adds metadata to remaining CVEs after cleanup)

### Within Each User Story

- Removal tasks (T006-T010) can run in parallel
- Metadata tasks (T023-T033) can run in parallel
- CODEOWNERS entries (T019-T022) can run in parallel

### Parallel Opportunities

**Phase 1**: T002-T003 are sequential (update then verify)
**Phase 2**: T004-T005 sequential (create dir then file)
**Phase 3**: T007-T010 can run in parallel (different CVE entries)
**Phase 4**: T015-T017 can run in parallel (different files)
**Phase 5**: T020-T022 can run in parallel (same file but different lines); T024-T033 can run in parallel

---

## Parallel Example: User Story 1 CVE Removals

```bash
# Launch all CVE removal tasks together (different entries in same file):
Task: "Remove CVE-2025-61726 entry from .trivyignore"
Task: "Remove CVE-2025-61728 entry from .trivyignore"
Task: "Remove CVE-2025-22869 entry from .trivyignore"
Task: "Remove CVE-2024-24790 entry from .trivyignore"
```

---

## Parallel Example: User Story 3 Metadata Updates

```bash
# Launch all metadata tasks together:
Task: "Add structured metadata to CVE-2025-47907 entry"
Task: "Add structured metadata to CVE-2025-58183 entry"
Task: "Add structured metadata to CVE-2025-64756 entry"
# ... etc
```

---

## Implementation Strategy

### MVP First (User Story 1 Only)

1. Complete Phase 1: Setup (T001-T003)
2. Complete Phase 2: Foundational (T004-T005)
3. Complete Phase 3: User Story 1 (T006-T014)
4. **STOP and VALIDATE**: Run Trivy scan, verify 10 CVEs remain
5. Deploy if ready - immediate security improvement

### Incremental Delivery

1. Setup + Foundational â†’ Foundation ready
2. Add User Story 1 â†’ Test with Trivy scan â†’ **Deploy (MVP!)**
3. Add User Story 2 â†’ Verify Dependabot alerts â†’ Deploy
4. Add User Story 3 â†’ Verify CODEOWNERS â†’ Deploy
5. Polish â†’ Final validation â†’ Complete

### Single Developer Strategy

With one developer:

1. Complete phases sequentially: Setup â†’ Foundational â†’ US1 â†’ US2 â†’ US3 â†’ Polish
2. Within each phase, maximize parallel task execution where marked [P]
3. Validate at each checkpoint before proceeding

---

## Notes

- [P] tasks = different entries/files, no dependencies
- [Story] label maps task to specific user story for traceability
- Trivy scan is the primary validation for US1
- GitHub UI steps (Dependabot enablement) documented but not automated
- CODEOWNERS requires branch protection enabled in GitHub settings
- Commit after each logical group of tasks
- Total: 39 tasks across 6 phases
