# Research: Security CVE Exception List Cleanup

**Feature**: 001-security-cve-cleanup
**Date**: 2026-01-31

## Summary

Research findings for implementing CVE exception cleanup, Dependabot monitoring, CODEOWNERS governance, and reviewdog smoke testing.

---

## R1: CVE Exception Cleanup Analysis

### Decision

Remove 5 CVEs from .trivyignore that have upstream fixes available. Retain 10 CVEs for upstream dependencies awaiting fixes.

### Findings

| CVE            | Package              | Current   | Fixed In          | Action                              |
| -------------- | -------------------- | --------- | ----------------- | ----------------------------------- |
| CVE-2026-25128 | fast-xml-parser      | 5.3.3     | 5.3.4             | REMOVE - run `pnpm update`          |
| CVE-2025-61726 | reviewdog stdlib     | Go 1.25.0 | Go 1.24.12/1.25.6 | REMOVE - Dockerfile already v0.21.0 |
| CVE-2025-61728 | reviewdog stdlib     | Go 1.25.0 | Go 1.24.12/1.25.6 | REMOVE - Dockerfile already v0.21.0 |
| CVE-2025-22869 | reviewdog crypto/ssh | v0.28.0   | v0.35.0           | REMOVE - v0.21.0 has fix            |
| CVE-2024-24790 | reviewdog net/netip  | Go 1.21.7 | Go 1.21.11/1.22.4 | REMOVE - v0.21.0 has fix            |

### Rationale

- Dockerfile already specifies `REVIEWDOG_VERSION=0.21.0` but .trivyignore still references v0.20.3
- fast-xml-parser comes via @azure/core-xml which has semver range ^5.0.7 (allows 5.3.4)
- pnpm update will pull 5.3.4 automatically

### Alternatives Considered

- Wait for next major Trivy scan before cleanup: Rejected - unnecessarily delays risk reduction
- Remove all exceptions and let CI fail: Rejected - upstream CVEs in OpenCode have no fix available

---

## R2: Dependabot Security Configuration

### Decision

Enable Dependabot security alerts and auto-PRs by ensuring the repository has security features enabled. No changes to dependabot.yml needed for vulnerability alerts.

### Findings

- Dependabot security updates are **separate** from version updates
- Security updates are enabled at the repository level via GitHub Settings > Security > Dependabot alerts
- The existing dependabot.yml handles version updates; security PRs are automatic when alerts are enabled
- Go binaries (reviewdog, OpenCode) are NOT covered by Dependabot - manual monitoring required

### Rationale

Dependabot security alerts provide:

- Automatic detection within 24 hours of advisory publication
- Auto-generated PRs with fix versions
- Integration with GitHub Security tab for visibility
- Native workflow without external tooling

### Alternatives Considered

- Snyk: More comprehensive but requires external account and billing
- Trivy scheduled scan comparison: More complex, less actionable (no auto-PRs)
- OSV.dev API polling: Would require custom implementation

### Gap: Go Binary Monitoring

Dependabot cannot monitor Go binaries. For OpenCode and reviewdog CVEs:

- Continue periodic manual review (quarterly minimum)
- Check upstream release notes when updating Dockerfile versions
- GitHub Security Advisories for Go packages provide some visibility

---

## R3: CODEOWNERS Configuration

### Decision

Create CODEOWNERS file with security-related paths owned by @oddessentials (existing reviewer in dependabot.yml).

### Findings

- No existing CODEOWNERS file in repository
- dependabot.yml already references `reviewers: ['oddessentials']`
- CODEOWNERS format: `path @owner` per line
- GitHub requires branch protection to enforce CODEOWNERS reviews

### Rationale

CODEOWNERS provides:

- Automatic review requests on PRs modifying security files
- Audit trail for security changes (GitHub tracks who approved)
- Enforcement via branch protection rules

### Configuration

```
# Security-sensitive files require designated owner review
.trivyignore @oddessentials
SECURITY.md @oddessentials
.github/dependabot.yml @oddessentials
router/Dockerfile @oddessentials
```

### Alternatives Considered

- GitHub Team: Would require org-level team creation, overkill for single-maintainer
- Rotating ownership: Adds complexity without benefit for small team

---

## R4: Reviewdog Smoke Test

### Decision

Add CI job that runs reviewdog against a known diff fixture to verify binary functionality after updates.

### Findings

- Reviewdog accepts diff input via stdin: `reviewdog -f=diff < file.diff`
- Exit code 0 = successful parsing, non-zero = error
- Minimal fixture needed: valid unified diff format with at least one hunk
- Can use `--reporter=local` for dry-run (no GitHub API calls)

### Rationale

Smoke test catches:

- Binary corruption during download
- Incompatible format changes between versions
- Missing dependencies in container image

Does NOT catch:

- GitHub API integration issues (would require live PR)
- Edge cases in specific diff formats

### Test Design

```bash
# Create minimal valid diff fixture
cat > tests/fixtures/reviewdog-smoke.diff << 'EOF'
diff --git a/test.txt b/test.txt
index 1234567..abcdefg 100644
--- a/test.txt
+++ b/test.txt
@@ -1,3 +1,3 @@
 line 1
-line 2
+line 2 modified
 line 3
EOF

# Smoke test command
reviewdog -f=diff -reporter=local < tests/fixtures/reviewdog-smoke.diff
echo "Reviewdog smoke test passed"
```

### Alternatives Considered

- Version check only (`reviewdog --version`): Too shallow, doesn't verify parsing
- Full integration test: Too heavy, requires live PR context
- Semgrep output test: Would test integration, not binary itself

---

## R5: .trivyignore Format Enhancement

### Decision

Add creation date and expiration tracking to each CVE exception using structured comments.

### Findings

- Trivy ignores comment lines starting with `#`
- Current format has freeform comments but no structured dates
- 180-day max age requires: creation date + calculated expiration

### Proposed Format

```
# CVE-ID: CVE-YYYY-NNNNN
# Created: YYYY-MM-DD
# Expires: YYYY-MM-DD (180 days from creation)
# Package: [package name]
# Risk: [LOW/MEDIUM/HIGH]
# Justification: [brief explanation]
# Upstream: [link to tracking issue if available]
CVE-YYYY-NNNNN
```

### Rationale

Structured comments enable:

- Scripted expiration checking (parse dates)
- Audit-friendly documentation
- Self-documenting exception lifecycle

### Alternatives Considered

- Separate tracking spreadsheet: Disconnected from source, drift risk
- JSON sidecar file: Not supported by Trivy, adds complexity
- Database: Overkill for <20 entries

---

## Outstanding Research Questions

None - all NEEDS CLARIFICATION items resolved.

## References

- [Trivy Documentation](https://aquasecurity.github.io/trivy/)
- [Dependabot Security Updates](https://docs.github.com/en/code-security/dependabot/dependabot-security-updates)
- [CODEOWNERS Syntax](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners)
- [Reviewdog CLI Reference](https://github.com/reviewdog/reviewdog#usage)
